#!/bin/bash
# Document processing wrapper with virtual environment management

set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
VENV_DIR="$SCRIPT_DIR/.venv-scripts"

# Check if python3-venv is available
check_venv_support() {
    if ! python3 -m venv --help >/dev/null 2>&1; then
        echo "‚ùå Error: Python virtual environment support not found"
        echo ""
        echo "Please install python3-venv:"
        echo "  Ubuntu/Debian: sudo apt install python3-venv"
        echo "  RHEL/CentOS:   sudo yum install python3-venv"
        echo "  macOS:         python3-venv is included with Python 3.3+"
        echo ""
        exit 1
    fi
}

# Create and activate virtual environment for scripts
setup_scripts_venv() {
    check_venv_support
    
    if [ ! -d "$VENV_DIR" ]; then
        echo "üîß Creating document processing virtual environment..."
        python3 -m venv "$VENV_DIR"
    fi
    
    # Activate virtual environment
    source "$VENV_DIR/bin/activate"
    
    # Install/upgrade pip and script dependencies
    pip install --quiet --upgrade pip
    pip install --quiet -r "$SCRIPT_DIR/scripts/requirements.txt"
}

# Setup virtual environment and run document processing
setup_scripts_venv
python3 scripts/process_documents_locally.py "$@"
